# Requirements Document

## Introduction

本ドキュメントは、Voiceletアプリケーションにおける「ユーザー検索機能」「ユニークID（ユーザー名）機能」「鍵アカウントのフィード除外機能」の要件を定義する。これらの機能により、ユーザーは他のユーザーを容易に発見でき、TwitterやInstagramのような一意の識別子（@ユーザー名）を持つことができる。

## Requirements

### Requirement 1: ユーザー検索機能

**Objective:** ユーザーとして、ホーム画面から他のユーザーをフリーテキストで検索したい。そうすることで、興味のあるユーザーを素早く見つけてフォローできる。

#### Acceptance Criteria

1. When ユーザーがホーム画面の検索アイコンをタップする, the 検索画面 shall 検索入力フィールドを表示する
2. When ユーザーが検索フィールドにテキストを入力する, the 検索サービス shall 表示名またはユニークID（@ユーザー名）に部分一致するユーザーを検索する
3. When 検索結果が取得される, the 検索画面 shall ユーザーのプロフィール画像、表示名、ユニークIDを含むリストを表示する
4. When ユーザーが検索結果のユーザーをタップする, the アプリケーション shall 該当ユーザーのプロフィール画面に遷移する
5. If 検索結果が0件の場合, then the 検索画面 shall 「該当するユーザーが見つかりませんでした」メッセージを表示する
6. While 検索処理中, the 検索画面 shall ローディングインジケーターを表示する
7. The 検索API shall 検索クエリを最低2文字以上で受け付ける

### Requirement 2: ユニークID（ユーザー名）機能

**Objective:** ユーザーとして、表示名とは別に一意のID（@ユーザー名）を設定したい。そうすることで、他のユーザーから確実に識別され、検索で見つけてもらいやすくなる。

#### Acceptance Criteria

1. The ユーザーモデル shall 表示名（displayName）とは別にユニークID（username）フィールドを持つ
2. The ユニークID shall システム全体で一意であることを保証する
3. When ユーザーがプロフィール編集画面でユニークIDを入力する, the バリデーションサービス shall 使用可能かどうかをリアルタイムでチェックする
4. If ユニークIDが既に使用されている場合, then the プロフィール編集画面 shall 「このユーザー名は既に使用されています」エラーを表示する
5. The ユニークID shall 半角英数字、アンダースコア（_）、ピリオド（.）のみを許可する
6. The ユニークID shall 3文字以上30文字以下の長さ制限を持つ
7. When ユニークIDの先頭に@が入力される, the 入力フィールド shall 自動的に@を除去して保存する
8. The ユーザープロフィール画面 shall ユニークIDを「@username」形式で表示する
9. When 新規ユーザーが登録する, the システム shall ユニークIDの設定を必須とする

### Requirement 3: ユニークIDの変更機能

**Objective:** ユーザーとして、設定したユニークIDを後から変更したい。そうすることで、ブランディングの変更や誤入力を修正できる。

#### Acceptance Criteria

1. When ユーザーがプロフィール編集画面を開く, the 画面 shall 現在のユニークIDを編集可能な状態で表示する
2. When ユーザーがユニークIDを変更して保存する, the システム shall 新しいユニークIDの一意性を検証してから更新する
3. If ユニークIDの変更が成功した場合, then the システム shall 成功メッセージを表示する
4. The 旧ユニークID shall 変更後すぐに他のユーザーが使用可能になる

### Requirement 4: 鍵アカウント（非公開アカウント）のおすすめフィード除外

**Objective:** ユーザーとして、おすすめフィードに鍵アカウント（非公開アカウント）のコンテンツが表示されないようにしたい。そうすることで、実際にフォローしてアクセスできるコンテンツのみを閲覧できる。

#### Acceptance Criteria

1. The おすすめフィードAPI shall 鍵アカウント（isPrivate=true）のユーザーの投稿を除外する
2. The おすすめユーザーリスト shall 鍵アカウントのユーザーを表示しない
3. While ユーザーが自分のアカウントを鍵アカウントに設定している場合, the そのユーザーの投稿 shall おすすめフィードに表示されない
4. When 鍵アカウントのユーザーが公開アカウントに変更する, the おすすめフィード shall 次回の取得時からそのユーザーの投稿を含める
5. The 検索結果 shall 鍵アカウントのユーザーも含めて表示する（検索では除外しない）

### Requirement 5: ユーザープロフィール表示の更新

**Objective:** ユーザーとして、他のユーザーのプロフィールでユニークIDを確認したい。そうすることで、そのユーザーを検索やメンションで正確に指定できる。

#### Acceptance Criteria

1. The ユーザープロフィール画面 shall 表示名の下にユニークID（@username形式）を表示する
2. The ユーザーカード（リスト表示） shall 表示名とユニークIDの両方を表示する
3. When ユニークIDをタップする, the システム shall ユニークIDをクリップボードにコピーする
4. The 自分のプロフィール画面 shall 自分のユニークIDを目立つ位置に表示する
